#!/bin/bash

CONTACT=node01
PORT=7000
RF=2
action=$1

case "$action" in
	create)
		redis-trib.rb create --replicas $RF \
192.168.0.42:7000 192.168.0.15:7000 192.168.0.50:7000 192.168.0.17:7000 192.168.0.48:7000 192.168.0.19:7000 \
192.168.0.20:7000 192.168.0.21:7000 192.168.0.22:7000 192.168.0.45:7000 192.168.0.24:7000 192.168.0.25:7000 \
192.168.0.26:7000 192.168.0.27:7000 192.168.0.49:7000 192.168.0.29:7000 192.168.0.30:7000 192.168.0.31:7000 \
192.168.0.42:7001 192.168.0.15:7001 192.168.0.50:7001 192.168.0.17:7001 192.168.0.48:7001 192.168.0.19:7001 \
192.168.0.20:7001 192.168.0.21:7001 192.168.0.22:7001 192.168.0.45:7001 192.168.0.24:7001 192.168.0.25:7001 \
192.168.0.26:7001 192.168.0.27:7001 192.168.0.49:7001 192.168.0.29:7001 192.168.0.30:7001 192.168.0.31:7001
	;;
	flush)
		fab remote_run:"printf 'flushall\n' | redis-cli -p 7000" -R servers
		fab remote_run:"printf 'flushall\n' | redis-cli -p 7001" -R servers
	;;		
	clean)
		fab cleanup:redis -R servers
	;;
	check)
		redis-trib.rb check ${CONTACT}:${PORT}
	;;
	*)
		echo "Usage: `basename $0` create|flush|clean|check"
	    exit 1
esac
