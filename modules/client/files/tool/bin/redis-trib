#!/bin/bash

N=20
CONTACT=node01
PORT=6379
action=$1
case "$action" in
	create)
		redis-trib.rb create --replicas 1 \
37.3.3.19:6379 37.3.3.20:6379 37.3.3.21:6379 37.3.3.22:6379 \
37.3.3.23:6379 37.3.3.24:6379 37.3.3.25:6379 37.3.3.26:6379 \
37.3.3.27:6379 37.3.3.28:6379 37.3.3.29:6379 37.3.3.30:6379 \
37.3.3.31:6379 37.3.3.32:6379 37.3.3.33:6379 37.3.3.34:6379 \
37.3.3.35:6379 37.3.3.36:6379 37.3.3.37:6379 37.3.3.38:6379
	;;
	flush)
		for (( i=1; i<=$N; i++ )); do
			node="node$i"
			[ $i -lt 10 ] && node="node0$i"
			printf "flush $node "
			echo "flushall" | redis-cli -h $node
			printf ""
		done
	;;		
	clean)
		fab service:redis,stop --set n=20,p=node
		fab remote_run:'rm -rf /local/data/redis/*' --set n=20,p=node
		fab service:redis,start --set n=20,p=node
	;;
	check)
		redis-trib.rb check ${CONTACT}:${PORT}
	;;
	*)
		echo "Usage: `basename $0` create|flush|clean|check"
	    exit 1
esac
